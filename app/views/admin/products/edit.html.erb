<% content_for :page_title, "Edit Product" %>

<div class="max-w-3xl">
  <div class="bg-white rounded-lg shadow p-6">
    <%= form_with model: [:admin, @product], class: "space-y-6" do |f| %>
      <div>
        <%= f.label :name, class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :name, required: true, class: "w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" %>
      </div>

      <div>
        <%= f.label :description, class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_area :description, rows: 4, required: true, class: "w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" %>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= f.label :category_id, "Category", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.collection_select :category_id, @categories, :id, :name, {},
              { required: true, class: "w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" } %>
        </div>

        <div>
          <%= f.label :sku, "SKU", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_field :sku, required: true, class: "w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" %>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= f.label :price, class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :price, step: 0.01, required: true, class: "w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" %>
        </div>

        <div>
          <%= f.label :stock_quantity, "Stock", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :stock_quantity, required: true, class: "w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" %>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <%= f.check_box :on_sale, class: "rounded", id: "product_on_sale" %>
        <%= f.label :on_sale, "On Sale", class: "text-sm font-medium text-gray-700" %>
      </div>

      <div id="sale-price-field" style="<%= @product.on_sale? ? '' : 'display: none;' %>">
        <%= f.label :sale_price, class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.number_field :sale_price, step: 0.01, class: "w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" %>
      </div>

      <% if @product.images.attached? %>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Current Images</label>
          <div class="grid grid-cols-4 gap-4">
            <% @product.images.each do |image| %>
              <%= image_tag image, class: "w-full h-24 object-cover rounded" %>
            <% end %>
          </div>
        </div>
      <% end %>

      <div>
        <%= f.label :images, "Add More Images", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.file_field :images, multiple: true, accept: "image/*", class: "w-full px-3 py-2 border rounded-lg" %>
      </div>

      <div class="flex gap-4">
        <%= f.submit "Update Product", class: "bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 cursor-pointer" %>
        <%= link_to "Cancel", admin_products_path, class: "px-6 py-2 border rounded-lg hover:bg-gray-50" %>
      </div>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const checkbox = document.getElementById('product_on_sale');
    const salePriceField = document.getElementById('sale-price-field');

    checkbox.addEventListener('change', function() {
      salePriceField.style.display = this.checked ? 'block' : 'none';
    });
  });
</script>